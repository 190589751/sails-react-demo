<!doctype html>
<html>
<head>
	<title>React Starter Component</title>
	<style>
a {text-decoration: none; color:blue;}
a:visited{
  color:blue;
}
a:hover {text-decoration: underline;}
a.selected {font-weight: bold;}
	</style>


</head>
<body>
	loading...

  <script src="/js/dependencies/standalone/underscore.min.js"></script>
	<script src="/js/dependencies/standalone/JSXTransformer.js"></script>
	<script src="/js/dependencies/standalone/react.js"></script>
	<script src="/js/dependencies/standalone/react-dom.js"></script>
  <script src="/js/dependencies/standalone/ReactRouter.js"></script>

	<script type="text/jsx">







var
  Router = ReactRouter.Router, 
	Route = ReactRouter.Route, 
	Link = ReactRouter.Link, 
  IndexRoute = ReactRouter.IndexRoute,
  DefaultRoute = ReactRouter.IndexRoute, 
  Redirect = ReactRouter.Redirect;

var todoDatabase = [
      {id: 1, text: 'this is an item todo', state: 'todo', order: 1},
      {id: 2, text: 'this is another item todo', state: 'todo', order: 2},
      {id: 3, text: 'yet another one', state: 'todo', order: 3},
      {id: 4, text: 'a todo item done', state: 'done', order: 4},
    ];
var nextTodoItemId = 5;


const TodoItem = React.createClass({
  setDone() {
    this.props.setState(this.props.id, 'done');
  },

  setDeleted() {
    this.props.setState(this.props.id, 'deleted');
  },

  render() {
    if (this.props.state == 'todo') {
      return (
        <div>{this.props.text} <a href="#">edit</a> <a href="#" onClick={this.setDone}>done</a> <a href="#">move up</a> <a href="#">move down</a></div>
      );     
    }
    else if (this.props.state == 'done') {
      return (
        <div>{this.props.text} <a href="#">edit</a> <a href="#" onClick={this.setDeleted}>delete</a> <a href="#">move up</a> <a href="#">move down</a></div>
      );     
    }
    else {
      return (
        <div>{this.props.text} (state:{this.props.state}) <a href="#">edit</a> <a href="#">move up</a> <a href="#">move down</a></div>
      );     
    }
  }
});


const TodoList = React.createClass({
  addTodoItem() {
    var text = window.prompt("New Item To Do","The thing that I need to do");
    if (text) {
      var newTodoItem = {id: nextTodoItemId++, text: text, state: 'todo', order: 999};
      this.setState({data: this.state.data.concat(newTodoItem)});
      //TODO push to back-end
      todoDatabase.push(newTodoItem);
    }
  },

  setTodoItemState(id, state) {
    console.log('setting state [' + state + '] for todo item [' + id + ']');

    var todoItem = _.findWhere(todoDatabase, {id: id});
    if (typeof todoItem !== 'undefined') {
      todoItem.state = state;
      this.setState({data: todoDatabase});
    }
  },

  getInitialState() {
    return {data: []};
  },  

  componentDidMount() {
    //TODO fetch data from back-end
    this.setState({data: todoDatabase});
  },

  render() {
    var self = this;
    var todoItems = [];
    if (this.state.data) {
      todoItems = _.sortBy(_.where(this.state.data, {state: this.props.state}), 'order').map(function(todoItem) {
        return (
          <TodoItem id={todoItem.id} text={todoItem.text} state={todoItem.state} setState={self.setTodoItemState}/>
        );
      });
    }

    if (this.props.state=='todo') {
      return (
        <div>
          <div><a href="#" onClick={this.addTodoItem}>add</a></div>
          {todoItems}
          <div><a href="#" onClick={this.addTodoItem}>add</a></div>
        </div>
      );
    }
    else {
      return (
        <div>
          {todoItems}
        </div>
      );
    }
  }
});


const Todo = React.createClass({
  render() {
    return (
      <div>
        <TodoList state='todo'/>
      </div>
    )
  }
});


const Done = React.createClass({
  render() {
    return (
      <div>
        <TodoList state='done'/>
      </div>
    )
  }
});


const About = React.createClass({
  render() {
    return (
      <div>
        <i>About</i>
      </div>
    )
  }
});


const App = React.createClass({

  render() {
    return (
      <div>
      	<h1><Link to="/">Simple Todo App</Link></h1>
      	<ul>
          <li><Link to="/" activeClassName="selected">todo</Link></li>
          <li><Link to="done" activeClassName="selected">done</Link></li>
          <li><Link to="about" activeClassName="selected">about</Link></li>
      	</ul>
        {this.props.children}
      </div>
    )
  }
});	

React.render((
  <Router>
    <Route path="" component={App}>
      <Route path="/" component={Todo} />
      <Route path="done" component={Done} />
      <Route path="about" component={About} />
    </Route>
  </Router>
), document.body);









</script>
</body>
</html>
